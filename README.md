# AutoDoor OCR 识别系统

一个自动化的OCR文字识别系统，用于监控屏幕特定区域并执行相应操作。

## 功能特性

### 核心功能
- ✅ 支持多显示器区域选择
- ✅ 可自定义OCR识别间隔（1-30秒）
- ✅ 支持中英文识别切换（英文/简体中文/繁体中文）
- ✅ 自动化鼠标点击和键盘操作
- ✅ 实时状态显示和日志记录
- ✅ 配置自动保存/加载
- ✅ Windows/macOS平台打包支持

### 模块化功能
- ✅ **首页Tab**：集中显示各功能状态，统一控制各模块开关
- ✅ **文字识别功能组管理**：支持最多15个独立文字识别组，可设置不同区域和参数
- ✅ **定时功能**：支持最多15个独立定时组，可设置不同按键和间隔，支持鼠标点击指定区域
- ✅ **数字识别功能**：支持最多15个独立区域，可设置阈值和触发按键
- ✅ **脚本运行功能**：支持录制鼠标操作和键盘按键操作，或直接手动编辑
- ✅ **颜色识别功能**：支持识别屏幕特定颜色并执行相应操作
- ✅ **报警功能**：支持自定义报警声音和音量调节

### 技术特性
- ✅ **模块化架构**：代码按功能分离，易于维护和扩展
- ✅ **现代UI框架**：基于 CustomTkinter，支持深色/浅色主题
- ✅ **代理模式**：模块间解耦，提高代码可维护性
- ✅ **单例模式**：截图管理器单例优化，提高性能
- ✅ **事件驱动**：优先级事件队列，支持事件插队处理

## 使用教程

B 站：[https://www.bilibili.com/video/BV1AGiGB8EYN](https://www.bilibili.com/video/BV1AGiGB8EYN)

## 安装要求

### 方法一：直接运行打包好的可执行文件（推荐）

#### Windows系统：
1. 从发布页面下载`autodoor-windows.zip`文件
2. 解压到任意目录
3. 运行`autodoor.exe`文件

#### macOS系统：
1. 从发布页面下载`autodoor-macos.zip`文件
2. 解压到任意目录
3. 运行`autodoor`可执行文件

### 方法二：从源码运行

#### 1. Python环境
- Python 3.8+ 版本

#### 2. 安装Python依赖

```bash
# 创建虚拟环境（推荐）
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/macOS:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

#### 3. Tesseract OCR引擎（可选）

系统会优先使用内置的Tesseract引擎，也可以使用外部安装的Tesseract：

##### Windows系统：
1. 下载Tesseract安装包：[Tesseract OCR](https://github.com/UB-Mannheim/tesseract/wiki)
2. 安装时记住安装路径

##### Linux系统：
```bash
sudo apt-get install tesseract-ocr
```

##### macOS系统：
```bash
brew install tesseract
```

## 使用方法

### 从源码运行
```bash
python autodoor.py
```

### 从可执行文件运行
- Windows：双击`autodoor.exe`文件
- macOS：双击`autodoor`可执行文件

## 项目架构

### 目录结构

```
autodoor/
├── autodoor.py              # 主程序入口
├── core/                    # 核心模块
│   ├── config.py            # 配置管理器
│   ├── controller.py        # 模块控制器
│   ├── events.py            # 事件管理器
│   ├── logging.py           # 日志管理器
│   ├── platform.py          # 平台适配器
│   ├── proxy.py             # 代理类（OCRProxy, TimedProxy等）
│   ├── threading.py         # 线程管理器
│   └── utils.py             # 核心工具函数
├── modules/                 # 功能模块
│   ├── ocr.py               # OCR识别模块
│   ├── timed.py             # 定时功能模块
│   ├── number.py            # 数字识别模块
│   ├── script.py            # 脚本执行模块
│   ├── color.py             # 颜色识别模块
│   ├── alarm.py             # 报警模块
│   ├── input.py             # 输入处理模块
│   └── recorder.py          # 录制模块
├── ui/                      # 用户界面
│   ├── home.py              # 首页标签页
│   ├── ocr_tab.py           # 文字识别标签页
│   ├── timed_tab.py         # 定时功能标签页
│   ├── number_tab.py        # 数字识别标签页
│   ├── script_tab.py        # 脚本运行标签页
│   ├── basic_tab.py         # 基本设置标签页
│   ├── theme.py             # 主题配置
│   ├── widgets.py           # 自定义组件
│   └── utils.py             # UI工具函数
├── utils/                   # 工具类
│   ├── screenshot.py        # 截图管理器（单例）
│   ├── image.py             # 图像处理工具
│   ├── tesseract.py         # Tesseract管理器
│   ├── version.py           # 版本检查器
│   ├── keyboard.py          # 键盘工具
│   └── region.py            # 区域选择工具
├── input/                   # 输入控制
│   ├── controller.py        # 输入控制器
│   ├── keyboard.py          # 键盘控制
│   └── permissions.py       # 权限管理
├── tesseract/               # 内置Tesseract引擎
│   └── tessdata/            # 语言数据
├── voice/                   # 音频文件
│   ├── alarm.mp3            # 报警声音
│   └── temp_reversed.mp3    # 停止音效
├── requirements.txt         # Python依赖
├── build_windows.bat        # Windows打包脚本
├── build_mac.sh             # macOS打包脚本
└── README.md                # 说明文档
```

### 架构设计

#### 模块化架构
项目采用模块化架构，各模块职责分明：

| 模块 | 职责 |
|------|------|
| `core/` | 核心功能：配置、事件、线程、日志管理 |
| `modules/` | 业务功能：OCR、定时、数字识别、脚本执行 |
| `ui/` | 用户界面：各标签页、主题、自定义组件 |
| `utils/` | 工具类：截图、图像处理、版本检查 |
| `input/` | 输入控制：键盘鼠标操作、权限管理 |

#### 设计模式

**代理模式（Proxy Pattern）**
```python
# core/proxy.py
class OCRProxy:
    """OCR模块代理，封装OCR组的操作"""
    
class TimedProxy:
    """定时模块代理，封装定时组的操作"""
    
class NumberProxy:
    """数字识别模块代理"""
```

**单例模式（Singleton Pattern）**
```python
# utils/screenshot.py
class ScreenshotManager:
    """截图管理器单例，避免重复截图"""
    _instance = None
    
    @classmethod
    def get_instance(cls):
        if cls._instance is None:
            cls._instance = cls()
        return cls._instance
```

**事件驱动模式**
```python
# core/events.py
class EventManager:
    """事件管理器，支持优先级队列"""
    def emit(self, event_type, data, priority=0): ...
    def process(self): ...
```

## 界面功能说明

### 首页标签页

1. **功能状态显示**
   - 显示所有功能模块的运行状态
   - 提供各模块的启用/禁用勾选框
   - 实时显示文字识别、定时功能、数字识别的运行状态

2. **全局控制按钮**
   - **开始运行**：启动所有勾选的功能模块
   - **停止运行**：停止所有正在运行的功能模块

3. **运行日志模块**
   - 实时显示应用运行日志
   - 支持滚动查看历史日志
   - 提供清除日志功能
   - 日志包含时间戳和详细的操作记录

4. **底部操作按钮**
   - **工具介绍**：打开工具的详细介绍文档（飞书链接）
   - **检查更新**：检查应用是否有新版本可用
   - **退出程序**：退出应用

### 文字识别标签页

1. **识别组管理**
   - 点击"新增识别组"按钮添加新的识别组
   - 每个识别组可独立启用/禁用
   - 支持最多15个独立识别组
   - 可删除不需要的识别组

2. **单组配置**
   - **区域选择**：拖动鼠标选择要监控的屏幕区域
   - **识别间隔**：设置OCR识别的时间间隔（1-30秒）
   - **暂停时长**：检测到关键词后的暂停时间（30-300秒）
   - **触发按键**：检测到关键词后自动按下的按键
   - **按键时长**：设置按键按下的最小和最大延迟
   - **启用报警**：检测到关键词时是否播放报警声音
   - **识别关键词**：输入多个关键词，用英文逗号分隔
   - **OCR识别语言**：选择识别语言（英文、简体中文、繁体中文）
   - **点击识别文字**：开关，用于控制检测到关键词时是否自动点击

### 定时功能标签页

1. **定时组管理**
   - 点击"新增定时组"按钮添加新的定时组
   - 每个定时组可独立启用/禁用
   - 支持最多15个独立定时组
   - 可删除不需要的定时组

2. **单组配置**
   - **间隔**：定时执行的时间间隔（秒）
   - **按键**：要按下的按键，支持自定义修改
   - **按键时长**：按键按下的最小和最大延迟（毫秒）
   - **启用报警**：执行按键时是否播放报警声音
   - **启用鼠标点击**：勾选状态下激活整个点击逻辑，未勾选时不执行任何点击相关操作
   - **选择位置**：点击按钮后，可在屏幕任意位置点击以记录坐标，坐标信息应实时显示


### 数字识别标签页

1. **识别区域管理**
   - 点击"新增识别区域"按钮添加新的识别区域
   - 每个识别区域可独立启用/禁用
   - 支持最多15个独立识别区域
   - 可删除不需要的识别区域

2. **单区域配置**
   - **选择区域**：选择要监控的数字区域
   - **阈值**：触发按键的数字阈值
   - **按键**：达到阈值时要按下的按键，支持自定义修改
   - **按键时长**：按键按下的最小和最大延迟（毫秒）
   - **启用报警**：达到阈值时是否播放报警声音

### 脚本运行标签页
1. **命令输入**
   - **按键命令**：设置按键、类型（按下/抬起）并插入命令
   - **延迟命令**：设置延迟时间并插入命令
   - **鼠标命令**：设置鼠标按键、操作类型并插入命令
   - **选择坐标点**：选择屏幕坐标并插入移动命令
   - **组合按键命令**：设置组合按键、延迟时间并插入命令

2. **脚本控制**
   - **开始录制**：开始录制键盘和鼠标操作
   - **停止录制**：停止录制并将操作保存为脚本
   - **清空脚本**：清除当前编辑器中的所有脚本内容
   - **导入脚本**：导入脚本文件
   - **导出脚本**：将当前脚本保存为文件

3. **颜色识别**
   - **颜色识别**：控制是否启用颜色识别
   - **选择区域**：选择要监控的屏幕区域
   - **选择颜色**：选择要识别的目标颜色
   - **颜色容差**：设置颜色识别的容差范围
   - **检查间隔**：设置颜色检查的时间间隔
   - **执行命令**：识别到颜色后执行的脚本命令

### 基本设置标签页

1. **Tesseract配置**
   - 显示当前Tesseract路径
   - 可手动设置Tesseract路径

2. **报警声音设置**
   - 选择自定义报警声音文件
   - 滑动条控制报警音量（0-100%）

3. **快捷键设置**
   - 可自定义开始/停止快捷键
   - 默认开始快捷键：F10
   - 默认停止快捷键：F12

4. **配置管理**
   - **保存配置**：手动保存当前配置
   - **重置配置**：恢复默认配置

## 操作流程

### 全局操作流程

1. 运行程序
2. 配置各功能模块：
   - 切换到对应标签页配置参数
   - 文字识别：选择区域、设置关键词和识别设置
   - 定时功能：配置定时组、间隔和按键
   - 数字识别：选择区域、设置阈值和按键
   - 脚本运行：录制或编辑脚本，配置颜色识别
   - 基本设置：配置Tesseract路径、报警声音和快捷键
3. 切换到"首页"标签页
4. 勾选要启用的功能模块
5. 点击"开始运行"按钮启动所有勾选的功能
6. 当检测到关键词或达到阈值时，系统会自动执行相应操作
7. 点击"停止运行"按钮可停止所有功能

### 文字识别配置

1. 切换到"文字识别"标签页
2. 点击"选择区域"按钮，拖动鼠标选择要监控的屏幕区域
3. 调整识别设置：
   - 设置识别间隔和暂停时长
   - 选择触发按键和按键时长
   - 根据需要启用报警
4. 设置关键词和语言：
   - 输入要识别的关键词
   - 选择合适的识别语言
   - 点击"保存关键词"

### 定时功能配置

1. 切换到"定时功能"标签页
2. 点击"新增定时组"添加定时组
3. 勾选"启用"开关
4. 设置定时间隔和要按下的按键
5. 调整按键时长（可选）
6. 根据需要启用报警
7. 鼠标点击配置（可选）：
   a. 勾选"启用鼠标点击"复选框
   b. 点击"选择位置"按钮，在屏幕任意位置点击以记录坐标
   c. 坐标信息将实时显示在"屏幕点击位置"文本框中
8. 重复以上步骤配置其他定时组
9. 可点击"删除"按钮删除不需要的定时组

### 数字识别配置

1. 切换到"数字识别"标签页
2. 点击"新增识别区域"添加识别区域
3. 勾选"启用"开关
4. 点击"选择区域"按钮，选择要监控的数字区域
5. 设置触发阈值和要按下的按键
6. 调整按键时长（可选）
7. 根据需要启用报警
8. 重复以上步骤配置其他识别区域
9. 可点击"删除"按钮删除不需要的识别区域

### 脚本运行配置

1. 切换到"脚本运行"标签页
2. **录制脚本**：
   - 点击"开始录制"按钮
   - 执行需要录制的键盘和鼠标操作
   - 点击"停止录制"按钮
   - 录制的操作会自动添加到脚本编辑器中
3. **编辑脚本**：
   - 在脚本编辑区域直接修改脚本内容
   - 使用命令输入区域的按钮插入各种命令
   - 支持手动编写脚本命令
4. **管理脚本**：
   - 点击"清空脚本"按钮清除所有脚本内容
   - 点击"导入脚本"按钮导入已有的脚本文件
   - 点击"导出脚本"按钮将当前脚本保存为文件
5. **运行脚本**：
   - 切换到"首页"标签页
   - 勾选"脚本运行"选项
   - 点击"开始运行"按钮
   - 脚本会按照编辑的内容执行相应的操作

### 颜色识别配置

1. 切换到"脚本运行"标签页，点击"颜色识别"标签
2. **基本配置**：
   - 勾选"颜色识别"复选框，启用颜色识别功能
   - 点击"选择区域"按钮，选择要监控的屏幕区域
   - 点击"选择颜色"按钮，选择要识别的目标颜色
   - 设置"颜色容差"和"检查间隔"
3. **命令配置**：
   - 在"颜色识别执行命令"文本框中输入要执行的脚本命令
   - 可以使用命令输入区域的按钮插入各种命令
4. **运行配置**：
   - 切换到"首页"标签页
   - 勾选"脚本运行"选项
   - 点击"开始运行"按钮
   - 当监控区域出现目标颜色时，系统会自动执行配置的命令

## 配置文件说明

程序会自动生成和加载配置文件，使用系统标准目录：

- **Windows**：`%APPDATA%/AutoDoorOCR/autodoor_config.json`
- **macOS**：`~/Library/Preferences/AutoDoorOCR/autodoor_config.json`

### 配置结构

```json
{
  "version": "2.0.4",
  "last_save_time": "ISO时间戳",
  "ocr": {
    "groups": [
      {
        "enabled": true,
        "region": [x1, y1, x2, y2],
        "interval": 5,
        "pause": 180,
        "key": "space",
        "delay_min": 300,
        "delay_max": 500,
        "alarm": false,
        "keywords": "door,men",
        "language": "eng",
        "click": false
      }
    ]
  },
  "timed_key_press": {
    "groups": [...]
  },
  "number_recognition": {
    "regions": [...]
  },
  "shortcuts": {
    "start": "F10",
    "stop": "F12"
  },
  "alarm": {
    "sound": "路径",
    "volume": 70,
    "ocr": {"enabled": false},
    "timed": {"enabled": false},
    "number": {"enabled": false}
  },
  "home_checkboxes": {
    "ocr": true,
    "timed": true,
    "number": true
  },
  "script": {
    "script_content": "...",
    "color_commands": "...",
    "color_recognition_region": [x1, y1, x2, y2],
    "target_color": [r, g, b],
    "color_tolerance": 10,
    "color_interval": 5,
    "color_recognition_enabled": false
  },
  "tesseract": {
    "path": "tesseract路径"
  }
}
```

## 日志文件

程序会生成日志文件，与配置文件位于同一目录：

- **Windows**：`%APPDATA%/AutoDoorOCR/autodoor.log`
- **macOS**：`~/Library/Preferences/AutoDoorOCR/autodoor.log`

## 打包说明

### Windows平台打包
```cmd
./build_windows.bat
```

### macOS平台打包
```bash
./build_mac.sh
```

打包后的可执行文件位于`dist/autodoor/`目录下。

## 开发说明

### 依赖包

| 依赖包 | 版本 | 用途 |
|--------|------|------|
| customtkinter | >=5.2.0 | 现代GUI框架 |
| pyautogui | >=0.9.54 | 自动化操作 |
| pytesseract | >=0.3.10 | OCR引擎接口 |
| Pillow | >=10.0.0 | 图像处理 |
| screeninfo | >=0.8.1 | 屏幕信息 |
| pygame | >=2.0.0 | 音频播放 |
| pynput | >=1.7.6 | 全局热键 |
| numpy | >=1.21.0 | 数值计算 |
| imagehash | >=4.3.2 | 图像哈希 |
| requests | >=2.31.0 | HTTP请求 |

### 扩展开发

#### 添加新模块

1. 在 `modules/` 目录创建新模块文件
2. 在 `core/proxy.py` 添加对应代理类
3. 在 `core/controller.py` 注册模块
4. 在 `ui/` 目录创建对应标签页

#### 自定义主题

修改 `ui/theme.py` 中的颜色和字体配置：

```python
class Theme:
    COLORS = {
        'primary': '#3B82F6',
        'success': '#22C55E',
        # ...
    }
    
    FONTS = {
        'family': 'Microsoft YaHei',
        'sizes': {...}
    }
```

## 注意事项

1. 选择的监控区域应包含清晰可见的文字
2. 运行脚本时请确保目标区域保持可见
3. Windows系统可能需要管理员权限
4. macOS系统需要在"安全性与隐私"中授权

### macOS用户注意事项

1. 通过 Homebrew 安装 Tesseract：`brew install tesseract`
2. 首次运行时授予屏幕截图权限
3. 在"系统偏好设置" > "安全性与隐私" > "隐私"中添加权限

## 故障排除

### Tesseract未检测到
- 检查配置文件中的Tesseract路径
- 程序会自动尝试使用内置引擎

### OCR识别结果为空
- 检查选择的区域是否包含清晰文字
- 尝试调整选择区域大小
- 尝试切换识别语言

### 无法模拟操作
- Windows：以管理员身份运行
- macOS：检查"安全性与隐私"设置

## 许可证

MIT License