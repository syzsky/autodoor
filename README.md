# AutoDoor OCR 识别系统

一个自动化的OCR文字识别系统，用于监控屏幕特定区域并执行相应操作。

## 功能特性

- ✅ 支持多显示器区域选择
- ✅ 可自定义OCR识别间隔（1-30秒）
- ✅ 支持中英文识别切换（英文/简体中文/繁体中文）
- ✅ 自动化鼠标点击和键盘操作
- ✅ 实时状态显示和日志记录
- ✅ 配置自动保存/加载
- ✅ Windows/macOS平台打包支持
- ✅ 首页Tab：集中显示各功能状态，统一控制各模块开关
- ✅ 文字识别功能组管理：支持最多15个独立文字识别组，可设置不同区域和参数
- ✅ 定时功能：支持最多15个独立定时组，可设置不同按键和间隔,鼠标点击指定区域功能
- ✅ 数字识别功能：支持最多15个独立区域，可设置阈值和触发按键
- ✅ 报警功能：支持自定义报警声音和音量调节
- ✅ 模块独立配置：每个功能模块都有独立的配置和开关
- ✅ 按键延迟配置：支持设置按键按下的最小和最大延迟
- ✅ 每个模块独立的报警开关控制
- ✅ 全局报警声音和音量设置
- ✅ 组启用状态可视化：点击当前组的任意区域可切换组启用状态，启用的组显示绿色边框和背景
- ✅ 版本更新提醒：自动检查版本更新并显示通知，支持手动检查更新
- ✅ 脚本运行功能：支持录制鼠标操作和键盘按键操作，或者直接手动编辑
- ✅ 颜色识别功能：支持识别屏幕特定颜色并执行相应操作

## 使用教程
B 站：[https://www.bilibili.com/video/BV1AGiGB8EYN](https://www.bilibili.com/video/BV1AGiGB8EYN)

## 安装要求

### 方法一：直接运行打包好的可执行文件（推荐）

#### Windows系统：
1. 从发布页面下载`autodoor-windows.zip`文件
2. 解压到任意目录
3. 运行`autodoor.exe`文件

#### macOS系统：
1. 从发布页面下载`autodoor-macos.zip`文件
2. 解压到任意目录
3. 运行`autodoor`可执行文件

### 方法二：从源码运行

#### 1. Python环境
- Python 3.8+ 版本

#### 2. 安装Python依赖

```bash
# 创建虚拟环境（推荐）
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/macOS:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

#### 3. Tesseract OCR引擎（可选）

系统会优先使用内置的Tesseract引擎，也可以使用外部安装的Tesseract：

##### Windows系统：
1. 下载Tesseract安装包：[Tesseract OCR](https://github.com/UB-Mannheim/tesseract/wiki)
2. 安装时记住安装路径

##### Linux系统：
```bash
sudo apt-get install tesseract-ocr
```

##### macOS系统：
```bash
brew install tesseract
```

## 使用方法

### 从源码运行
```bash
python autodoor.py
```

### 从可执行文件运行
- Windows：双击`autodoor.exe`文件
- macOS：双击`autodoor`可执行文件

## 界面功能说明

### 首页标签页

1. **功能状态显示**
   - 显示所有功能模块的运行状态
   - 提供各模块的启用/禁用勾选框
   - 实时显示文字识别、定时功能、数字识别的运行状态

2. **全局控制按钮**
   - **开始运行**：启动所有勾选的功能模块
   - **停止运行**：停止所有正在运行的功能模块

3. **运行日志模块**
   - 实时显示应用运行日志
   - 支持滚动查看历史日志
   - 提供清除日志功能
   - 日志包含时间戳和详细的操作记录

4. **底部操作按钮**
   - **工具介绍**：打开工具的详细介绍文档（飞书链接）
   - **检查更新**：检查应用是否有新版本可用
   - **退出程序**：退出应用

### 文字识别标签页

1. **识别组管理**
   - 点击"新增识别组"按钮添加新的识别组
   - 每个识别组可独立启用/禁用
   - 支持最多15个独立识别组
   - 可删除不需要的识别组

2. **单组配置**
   - **区域选择**：点击"选择区域"按钮，拖动鼠标选择要监控的屏幕区域
   - **区域坐标**：显示当前选择的区域坐标
   - **识别间隔**：设置OCR识别的时间间隔（1-30秒）
   - **暂停时长**：检测到关键词后的暂停时间（30-300秒）
   - **触发按键**：检测到关键词后自动按下的按键，支持自定义修改
   - **按键时长**：设置按键按下的最小和最大延迟（毫秒）
   - **启用报警**：开关，用于控制检测到关键词时是否播放报警声音
   - **识别关键词**：输入多个关键词，用英文逗号分隔
   - **OCR识别语言**：选择识别语言（英文、简体中文、繁体中文）
   - **点击识别文字**：开关，用于控制检测到关键词时是否自动点击

### 定时功能标签页

1. **定时组管理**
   - 点击"新增定时组"按钮添加新的定时组
   - 每个定时组可独立启用/禁用
   - 支持最多15个独立定时组
   - 可删除不需要的定时组

2. **单组配置**
   - **间隔**：定时执行的时间间隔（秒）
   - **按键**：要按下的按键，支持自定义修改
   - **按键时长**：按键按下的最小和最大延迟（毫秒）
   - **启用报警**：执行按键时是否播放报警声音
   - **启用鼠标点击**：勾选状态下激活整个点击逻辑，未勾选时不执行任何点击相关操作
   - **选择位置**：点击按钮后，可在屏幕任意位置点击以记录坐标，坐标信息应实时显示


### 数字识别标签页

1. **识别区域管理**
   - 点击"新增识别区域"按钮添加新的识别区域
   - 每个识别区域可独立启用/禁用
   - 支持最多15个独立识别区域
   - 可删除不需要的识别区域

2. **单区域配置**
   - **选择区域**：点击"选择区域"按钮，拖动鼠标选择要监控的数字区域
   - **区域坐标**：显示当前选择的区域坐标
   - **阈值**：触发按键的数字阈值
   - **按键**：达到阈值时要按下的按键，支持自定义修改
   - **按键时长**：按键按下的最小和最大延迟（毫秒）
   - **启用报警**：达到阈值时是否播放报警声音


### 脚本运行标签页
1. **命令输入**
   - **按键命令**：设置按键、类型（按下/抬起）并插入命令
   - **延迟命令**：设置延迟时间并插入命令
   - **鼠标命令**：设置鼠标按键、操作类型并插入命令
   - **选择坐标点**：选择屏幕坐标并插入移动命令
   - **组合按键命令**：设置组合按键、延迟时间并插入命令

2. **脚本控制**
   - **开始录制**：开始录制键盘和鼠标操作
   - **停止录制**：停止录制并将操作保存为脚本
   - **清空脚本**：清除当前编辑器中的所有脚本内容
   - **导入脚本**：打开文件选择对话框，导入脚本文件
   - **导出脚本**：将当前脚本保存为文件

3. **脚本编辑**
   - 编辑和查看录制的脚本内容
   - 支持滚动查看

4. **颜色识别**
   - **颜色识别**：勾选框，控制是否在脚本运行时启用颜色识别
   - **选择区域**：选择要监控的屏幕区域
   - **选择颜色**：选择要识别的目标颜色
   - **颜色容差**：设置颜色识别的容差范围
   - **检查间隔**：设置颜色检查的时间间隔
   - **颜色识别执行命令**：识别到颜色后进行执行的脚本命令

### 基本设置标签页

1. **Tesseract配置**
   - 显示当前Tesseract路径
   - 可手动设置Tesseract路径

2. **报警声音设置**
   - **报警声音**：选择自定义报警声音文件
   - **音量调节**：滑动条控制报警音量（0-100%）

3. **快捷键设置**
   - 可自定义开始/停止快捷键
   - 默认开始快捷键：F10
   - 默认停止快捷键：F12
   - **全局快捷键**：即使应用失去焦点，也能使用快捷键控制应用运行

4. **配置管理**
   - **保存配置**：手动保存当前配置
   - **重置配置**：恢复默认配置

## 操作流程

### 全局操作流程

1. 运行程序
2. 配置各功能模块：
   - 切换到对应标签页配置参数
   - 文字识别：选择区域、设置关键词和识别设置
   - 定时功能：配置定时组、间隔和按键
   - 数字识别：选择区域、设置阈值和按键
   - 脚本运行：录制或编辑脚本，配置颜色识别
   - 基本设置：配置Tesseract路径、报警声音和快捷键
3. 切换到"首页"标签页
4. 勾选要启用的功能模块
5. 点击"开始运行"按钮启动所有勾选的功能
6. 当检测到关键词或达到阈值时，系统会自动执行相应操作
7. 点击"停止运行"按钮可停止所有功能

### 文字识别配置

1. 切换到"文字识别"标签页
2. 点击"选择区域"按钮，拖动鼠标选择要监控的屏幕区域
3. 调整识别设置：
   - 设置识别间隔和暂停时长
   - 选择触发按键和按键时长
   - 根据需要启用报警
4. 设置关键词和语言：
   - 输入要识别的关键词
   - 选择合适的识别语言
   - 点击"保存关键词"

### 定时功能配置

1. 切换到"定时功能"标签页
2. 点击"新增定时组"添加定时组
3. 勾选"启用"开关
4. 设置定时间隔和要按下的按键
5. 调整按键时长（可选）
6. 根据需要启用报警
7. 鼠标点击配置（可选）：
   a. 勾选"启用鼠标点击"复选框
   b. 点击"选择位置"按钮，在屏幕任意位置点击以记录坐标
   c. 坐标信息将实时显示在"屏幕点击位置"文本框中
8. 重复以上步骤配置其他定时组
9. 可点击"删除"按钮删除不需要的定时组

### 数字识别配置

1. 切换到"数字识别"标签页
2. 点击"新增识别区域"添加识别区域
3. 勾选"启用"开关
4. 点击"选择区域"按钮，选择要监控的数字区域
5. 设置触发阈值和要按下的按键
6. 调整按键时长（可选）
7. 根据需要启用报警
8. 重复以上步骤配置其他识别区域
9. 可点击"删除"按钮删除不需要的识别区域

### 脚本运行配置

1. 切换到"脚本运行"标签页
2. **录制脚本**：
   - 点击"开始录制"按钮
   - 执行需要录制的键盘和鼠标操作
   - 点击"停止录制"按钮
   - 录制的操作会自动添加到脚本编辑器中
3. **编辑脚本**：
   - 在脚本编辑区域直接修改脚本内容
   - 使用命令输入区域的按钮插入各种命令
   - 支持手动编写脚本命令
4. **管理脚本**：
   - 点击"清空脚本"按钮清除所有脚本内容
   - 点击"导入脚本"按钮导入已有的脚本文件
   - 点击"导出脚本"按钮将当前脚本保存为文件
5. **运行脚本**：
   - 切换到"首页"标签页
   - 勾选"脚本运行"选项
   - 点击"开始运行"按钮
   - 脚本会按照编辑的内容执行相应的操作

### 颜色识别配置

1. 切换到"脚本运行"标签页，点击"颜色识别"标签
2. **基本配置**：
   - 勾选"颜色识别"复选框，启用颜色识别功能
   - 点击"选择区域"按钮，选择要监控的屏幕区域
   - 点击"选择颜色"按钮，选择要识别的目标颜色
   - 设置"颜色容差"和"检查间隔"
3. **命令配置**：
   - 在"颜色识别执行命令"文本框中输入要执行的脚本命令
   - 可以使用命令输入区域的按钮插入各种命令
4. **运行配置**：
   - 切换到"首页"标签页
   - 勾选"脚本运行"选项
   - 点击"开始运行"按钮
   - 当监控区域出现目标颜色时，系统会自动执行配置的命令

## 配置文件说明

程序会自动生成和加载配置文件，使用系统标准目录：

- **Windows**：`%APPDATA%/AutoDoorOCR/autodoor_config.json`
- **macOS**：`~/Library/Preferences/AutoDoorOCR/autodoor_config.json`

配置文件包含以下配置项：

### 基本配置
- `version`：配置文件版本号
- `last_save_time`：上次保存配置的时间

### 首页配置
- `home_checkboxes`：首页功能模块启用状态
  - `ocr`：文字识别模块是否启用
  - `timed`：定时功能模块是否启用
  - `number`：数字识别模块是否启用

### OCR文字识别配置
- `ocr`：文字识别相关配置
  - `groups`：文字识别组列表（最多15个）
    - `enabled`：是否启用该识别组
    - `region`：选择的监控区域坐标
    - `interval`：OCR识别间隔（秒）
    - `pause`：暂停时长（秒）
    - `key`：触发按键
    - `delay_min`：按键按下的最小延迟（毫秒）
    - `delay_max`：按键按下的最大延迟（毫秒）
    - `alarm`：是否启用报警
    - `keywords`：识别关键词
    - `language`：OCR识别语言
    - `click`：是否点击识别文字

### 点击模式配置
- `click`：点击模式相关配置
  - `mode`：点击模式（center/custom）
  - `x`：自定义X坐标
  - `y`：自定义Y坐标

### 定时功能配置
- `timed_key_press`：定时功能相关配置
  - `groups`：定时组列表（最多15个）
    - `enabled`：是否启用该定时组
    - `interval`：定时间隔（秒）
    - `key`：要按下的按键
    - `delay_min`：按键按下的最小延迟（毫秒）
    - `delay_max`：按键按下的最大延迟（毫秒）
    - `alarm`：该定时组是否启用报警
    - `click_enabled`：是否启用鼠标点击功能
    - `position_x`：屏幕点击位置的X坐标
    - `position_y`：屏幕点击位置的Y坐标
    - `position`：屏幕点击位置的字符串表示

### 数字识别配置
- `number_recognition`：数字识别相关配置
  - `regions`：数字识别区域列表（最多15个）
    - `enabled`：是否启用该区域
    - `region`：选择的数字区域坐标
    - `threshold`：触发阈值
    - `key`：要按下的按键
    - `delay_min`：按键按下的最小延迟（毫秒）
    - `delay_max`：按键按下的最大延迟（毫秒）
    - `alarm`：该区域是否启用报警

### 快捷键配置
- `shortcuts`：快捷键配置
  - `start`：开始快捷键
  - `stop`：停止快捷键

### 报警配置
- `alarm`：报警相关配置
  - `sound`：报警声音文件路径
  - `volume`：报警音量（0-100）
  - `ocr`：文字识别模块报警配置
    - `enabled`：是否启用报警
  - `timed`：定时功能模块报警配置
    - `enabled`：是否启用报警
  - `number`：数字识别模块报警配置
    - `enabled`：是否启用报警

### Tesseract配置
- `tesseract`：Tesseract OCR引擎配置
  - `path`：Tesseract OCR引擎路径

## 日志文件

程序会生成日志文件，与配置文件位于同一目录：

- **Windows**：`%APPDATA%/AutoDoorOCR/autodoor.log`
- **macOS**：`~/Library/Preferences/AutoDoorOCR/autodoor.log`
- **其他系统**：`程序运行目录/config/autodoor.log`

日志文件包含：
- 程序启动和退出记录
- 配置加载和保存记录
- Tesseract检测结果
- OCR识别结果
- 操作执行记录
- 错误和异常信息

## 打包说明

### Windows平台打包
使用批处理脚本进行打包：
```cmd
./build_windows.bat
```

### macOS平台打包
使用Shell脚本进行打包：
```bash
./build_mac.sh
```

打包后的可执行文件位于`dist/autodoor/`目录下，包含所有必要的依赖文件和内置的Tesseract引擎。

## 注意事项

1. 选择的监控区域应包含清晰可见的文字
2. 运行脚本时请确保目标区域保持可见
3. Windows系统可能需要管理员权限才能正常模拟鼠标和键盘操作
4. macOS系统可能需要在"安全性与隐私"中允许程序控制电脑
5. 程序会自动检测和使用内置的Tesseract引擎，无需额外安装

### 对于 macOS 用户：
1. 下载 Tesseract ：
   - 通过 Homebrew 安装： brew install tesseract
   - 或从官方网站下载预编译版本

2. 配置 Tesseract 路径 ：
   - 打开 AutoDoor 应用程序
   - 进入 "基本设置" 标签页
   - 在 "Tesseract OCR 路径" 字段中输入 Tesseract 的安装路径
   - 点击 "保存配置" 按钮

3. 授予必要的权限 ：
   - 首次运行时，macOS 会提示授予屏幕截图权限
   - 请点击 "允许"，确保应用程序能正常工作

4. 验证权限设置 ：
   - 进入 "系统偏好设置" > "安全性与隐私" > "隐私"
   - 确保 AutoDoor 已被添加到 "屏幕录制" 和 "辅助功能" 列表中

## 故障排除

### 问题：Tesseract未检测到
- 检查配置文件中的Tesseract路径是否正确
- 程序会自动尝试使用内置的Tesseract引擎

### 问题：OCR识别结果为空
- 检查选择的区域是否包含清晰的文字
- 尝试调整选择区域大小
- 尝试切换识别语言

### 问题：无法模拟鼠标/键盘操作
- Windows：尝试以管理员身份运行程序
- macOS：检查"安全性与隐私"设置，允许程序控制电脑
- 检查是否有其他软件阻止了自动化操作

### 问题：程序崩溃
- 检查Python版本是否符合要求（3.8+）
- 查看日志文件`autodoor.log`中的错误信息
- 重新安装依赖包：`pip install -r requirements.txt`

## 开发说明

### 项目结构

```
autodoor/
├── autodoor.py          # 主程序文件
├── autodoor_config.json # 配置文件
├── autodoor.log         # 日志文件
├── autodoor.spec        # PyInstaller配置文件
├── build_windows.bat    # Windows打包脚本
├── build_mac.sh         # macOS打包脚本
├── requirements.txt     # Python依赖
├── README.md            # 说明文档
└── tesseract/           # 内置Tesseract引擎目录
    └── ...
```

### 依赖包

- pyautogui >= 0.9.54
- pytesseract >= 0.3.10
- Pillow >= 10.0.0
- screeninfo >= 0.8.1
- pygame >= 2.0.0
- pydub >= 0.25.1
- requests >= 2.31.0
- pyinstaller (用于打包)

## 许可证

MIT License